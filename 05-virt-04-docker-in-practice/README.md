# Домашнее задание к занятию 5. «Практическое применение Docker»

### Инструкция к выполнению

1. Для выполнения заданий обязательно ознакомьтесь с [инструкцией](https://github.com/netology-code/devops-materials/blob/master/cloudwork.MD) по экономии облачных ресурсов. Это нужно, чтобы не расходовать средства, полученные в результате использования промокода.
3. Своё решение к задачам оформите в вашем GitHub репозитории.
4. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

---

## Задача 1
1. Сделайте fork репозитория ```https://github.com/netology-code/shvirtd-example-python/blob/main/README.md```.   
2. **Необязательно.** Изучите инструкцию проекта и запустите приложение без использования docker в venv. (Mysql БД можно запустить в docker run).   
3. Создайте файл ```Dockerfile.python``` для сборки данного проекта. Используйте базовый образ ```python:3.9-slim``` Протестируйте корректность сборки. Не забудьте dockerignore.    

## Ответ 1

### Dockerfile
```
# Используем базовый образ python:3.9-slim
FROM python:3.9-slim

# Установим рабочую директорию в контейнере
WORKDIR /app

# Копируем файлы проекта в рабочую директорию
COPY . /app

# Установим зависимости из файла requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Определяем переменные среды для подключения к базе данных
ENV DB_HOST=new-mysql-db \
    DB_USER=app \
    DB_PASSWORD=very_strong \
    DB_NAME=example

# Открываем порт 5000
EXPOSE 5000

# Запускаем приложение
CMD ["python", "main.py"]
```

### dockerignore

```
venv
*.pyc
*.pyo
*.pyd
__pycache__
```
![alt text](https://github.com/shatskiy-O/virtd-homeworks/blob/shvirtd-1/05-virt-04-docker-in-practice/img/1.png)

## Задача 2
1. Создайте файл ```compose.yaml```. Опишите в нем следующие сервисы: 

- ```web```. Образ должен собираться при запуске compose из файла ```Dockerfile.python```. Контейнер должен работать в bridge-сети с названием ```backend``` и иметь фиксированный ipv4-адрес ```172.20.0.5```. Сервис должен всегда перезапускаться в случае ошибок.
Передайте необходимые ENV-переменные для подключения к Mysql базе данных по имени сервиса ```web```

- ```db```. image=mysql:8. Контейнер должен работать в bridge-сети с названием ```backend``` и иметь фиксированный ipv4-адрес ```172.20.0.10```. Сервис должен всегда перезапускаться в случае ошибок. Передайте необходимые ENV-переменные для создания: пароля root пользователя, создания базы данных, пользователя и пароля для web-приложения.

2. Одной командой запустите c помощью docker compose ```compose.yaml``` и ```proxy.yaml```, добейтесь его стабильной работы.

3. Протестируйте локально приложение с помощью команд ```curl -L http://127.0.0.1:8080``` и ```curl -L http://127.0.0.1:8090```.

4. Подключитесь к БД mysql с помощью команды ```docker exec <имя_контейнера> mysql -uroot -p<пароль root-пользователя>``` . Введите последовательно команды (не забываем ```;``` ): ```show databases; use <имя вашей базы данных(по-умолчанию example)>; show tables; select * from requests;```.

5. Остановите проект и закомитьте все изменения в свой fork-репозиторий. В качестве ответа приложите скриншот таблицы ```requests```.

## Задача 3
1. Запустите в Yandex Cloud ВМ согласно инструкциям (вам хватит 2 Гб Ram).
2. Установите стек docker приложений.
3. Напишите bash-скрипт, который скачает ваш fork-репозиторий в каталог /opt и запустит проект целиком.
4. Зайдите на сайт проверки http подключений, например(или аналогичный): ```https://check-host.net/check-http``` и проверьте ваш адрес ```http://<внешний_IP-адрес_вашей_ВМ>:5000```.
5. В качестве ответа приложите скриншот таблицы ```requests``` с данного сервера и bash-скрипт.

### Правила приема

Домашнее задание выполните в файле readme.md в GitHub-репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.
